---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2025/2/18 16:12
---

local LuaClass = require("Core/LuaClass")
local ActorUtil = require("Utils/ActorUtil")

---@class ModelChocoboController
local ModelChocoboController = LuaClass()

function ModelChocoboController:Ctor()
    self.ChocoboEntityID = -1
end

function ModelChocoboController:GetFocusPoint()
end

function ModelChocoboController:Create(LocationParam, RotationParam)
    local Params = _G.UE.FCreateClientActorParams()
    Params.bUIActor = true

    self.ChocoboEntityID = _G.UE.UActorManager:Get():CreateClientActorByParams(_G.UE.EActorType.Npc, 
            0, 30001674, LocationParam, RotationParam, Params)
    self.ChildActor = ActorUtil.GetActorByEntityID(self.ChocoboEntityID)
    local AttrComp = self.ChildActor:GetAttributeComponent()
    if  AttrComp ~= nil then
        AttrComp.SubType = _G.UE.EActorSubType.Buddy
    end

    _G.UE.UVisionMgr.Get():RemoveFromVision(self.ChildActor)
    self.ChildActor:GetAvatarComponent():SwitchForceMipStreaming(true)
    self.ChildActor:SetOverrideFadeInTime(0.0)
    self.ChildActorLocation = LocationParam

    local Component = self.ChildActor:GetComponentByClass(_G.UE.USkeletalMeshComponent)
    if Component ~= nil then
        self.SkeletalMeshComponent = Component:Cast(_G.UE.USkeletalMeshComponent)
    end
    
    return self.ChocoboEntityID
end

function ModelChocoboController:Release()
    _G.UE.UActorManager.Get():RemoveClientActor(self.ChocoboEntityID)
    self.ChocoboEntityID = -1
end

function ModelChocoboController:GetChildActor()
    return self.ChildActor
end

function ModelChocoboController:GetSkeletalMeshComponent()
    return self.SkeletalMeshComponent
end

function ModelChocoboController:SetModelLocation(InX, InY, InZ)
    if self.ChildActor == nil then
        return
    end

    self.ChildActor:K2_SetActorLocation(_G.UE.FVector(InX + self.ChildActorLocation.x, InY + self.ChildActorLocation.y, InZ + self.ChildActorLocation.z), false, nil, false)
end

function ModelChocoboController:GetModelLocation()
    if nil == self.ChildActor then
        return
    end

    return self.ChildActor:K2_GetActorLocation() - self.ChildActorLocation
end

function ModelChocoboController:SetModelRotation(InPitch, InYaw, InRoll)
    if self.SkeletalMeshComponent ~= nil and _G.UE.UCommonUtil.IsObjectValid(self.SkeletalMeshComponent) then
        local NewRotation = _G.UE.FRotator(InPitch, InYaw, InRoll)
        self.SkeletalMeshComponent:K2_SetRelativeRotation(NewRotation, false, _G.UE.FHitResult(), false)
    end
end

function ModelChocoboController:GetModelRotation()
    if self.SkeletalMeshComponent ~= nil and _G.UE.UCommonUtil.IsObjectValid(self.SkeletalMeshComponent) then
        local Rotation = self.SkeletalMeshComponent:GetRelativeRotation()
        return Rotation
    end
    
    return self.ChildActor:K2_GetActorRotation()
end

return ModelChocoboController