---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2024/8/16 16:24
---

local LuaClass = require("Core/LuaClass")
local UIViewModel = require("UI/UIViewModel")
local ProtoCommon = require("Protocol/ProtoCommon")
local SceneEnterTypeCfg = require("TableCfg/SceneEnterTypeCfg")
local MagicCardTourneyMgr = require("Game/MagicCardTourney/MagicCardTourneyMgr")
local PWorldEntUtil = require("Game/PWorld/Entrance/PWorldEntUtil")

local PworldEntMagicCardVM = LuaClass(UIViewModel)

function PworldEntMagicCardVM:Ctor()
    --self.TypeID = 0
    self.IsMatching = false
    self.IsUnlock = true
    self.bShowStatus = false
    self.StatusImage = ""
    self.StatusText = ""
end

function PworldEntMagicCardVM:UpdateVM(Data)
    --self.TypeID = Data.ID

    self:UpdMatch()
    self:UpdLock()

    self:UpdateStatus()
end

function PworldEntMagicCardVM:UpdMatch()
    self.IsMatching = MagicCardTourneyMgr.GetIsInMatching()
    -- local EntSet = SceneEnterTypeCfg:GetPWorldEntIDs(self.TypeID) or {}
    -- local Matches = _G.PWorldMatchMgr:GetMatchChocoboItems()
    -- local HasOverlap = table.set_has_overlap(EntSet, Matches)
    -- self.IsMatching = HasOverlap
end

function PworldEntMagicCardVM:UpdLock()
    -- local EntSet = SceneEnterTypeCfg:GetPWorldEntIDs(self.TypeID) or {}
    -- local Rlt = false
    -- for _, EntID in pairs(EntSet) do
    --     local Pol = PWorldEntUtil.GetPol(EntID, self.TypeID)
    --     local IsCheckOK = Pol:CheckFilter(EntID)
    --     Rlt = Rlt or IsCheckOK
    --     if Rlt then
    --         break
    --     end
    -- end

    --self.IsUnlock = Rlt
    self.IsUnlock = _G.ModuleOpenMgr:CheckOpenState(ProtoCommon.ModuleID.ModuleIDFantasyCard)
    self:UpdateStatus()
end


function PworldEntMagicCardVM:UpdateStatus()
    self.bShowStatus = self.IsMatching or (not self.IsUnlock)
    if self.IsMatching then
        self.StatusImage = "PaperSprite'/Game/UI/Atlas/HUD/Frames/UI_Icon_061517_png.UI_Icon_061517_png'"
        self.StatusText = _G.LSTR(1320008) --匹配中
    elseif not self.IsUnlock then
        self.StatusImage = "PaperSprite'/Game/UI/Atlas/HUDQuest/Frames/UI_Icon_Hud_Plus_Missed_png.UI_Icon_Hud_Plus_Missed_png'"
        self.StatusText = _G.LSTR(1320215) -- 任务解锁
    end
end

return PworldEntMagicCardVM