---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2024/7/9 16:34
---

local LuaClass = require("Core/LuaClass")
local UIViewModel = require("UI/UIViewModel")
local TouringBandCfg = require("TableCfg/TouringBandCfg")
local ItemCfg = require("TableCfg/ItemCfg")
local EmotionCfg = require("TableCfg/EmotionCfg")
local CompanionCfg = require("TableCfg/CompanionCfg")
local ProtoCS = require("Protocol/ProtoCS")

local TouringBandMgr = nil
local LSTR = nil

---@type TouringBandFanWinVM : UIViewModel
local TouringBandFanWinVM = LuaClass(UIViewModel)

function TouringBandFanWinVM:Ctor()
    TouringBandMgr = _G.TouringBandMgr
    LSTR = _G.LSTR
    self:Reset()
end

function TouringBandFanWinVM:Reset()
    self.TextContent = ""
    self.TextExterior = ""
    self.TextEPet = ""
    self.TextAction = ""
    self.IsShowExterior = false
    self.IsShowEPet = false
    self.IsShowAction = false
end

function TouringBandFanWinVM:UpdateVM(BandID)
    self:Reset()
    local BandCfg = TouringBandCfg:FindCfgByKey(BandID)
    if BandCfg == nil then
        return
    end

    local BandData = TouringBandMgr:GetBandDataByID(BandID)
    if BandData == nil then
        return
    end

    local BandName = string.format("<span color=\"#d1ba8e\">%s</>", BandCfg.BandName)
    -- LSTR string: 恭喜你成为%s乐团的粉丝，解锁歌曲点播
    local Content = string.format(LSTR(450017), BandName)
    self.TextContent = Content

    local PetID = BandCfg.PetID
    local EmotionID = BandCfg.EmotionID

    self.IsShowExterior = false
    self.IsShowEPet = false
    self.IsShowAction = false

    if BandData.InteractRecords ~= nil then
        for Key, Value in pairs(BandData.InteractRecords) do
            if Key == ProtoCS.Game.TouringBand.ReportType.Emotion then
                self.IsShowAction = Value > 0
            elseif Key == ProtoCS.Game.TouringBand.ReportType.Equip then
                self.IsShowExterior = Value > 0
            elseif Key == ProtoCS.Game.TouringBand.ReportType.Companion then
                self.IsShowEPet = Value > 0
            elseif Key == ProtoCS.Game.TouringBand.ReportType.Appearance then
                self.IsShowExterior = Value > 0
            end
        end
    end

    if self.IsShowExterior then
        -- LSTR string: 穿着%s
        self.TextExterior = string.format(LSTR(450014), BandCfg.AppearanceDesc or "")
    end

    if self.IsShowEPet then
        local PetCfg = CompanionCfg:FindCfgByKey(PetID)
        if PetCfg ~= nil then
            -- LSTR string: 携带%s
            self.TextEPet = string.format(LSTR(450015), PetCfg.Name)
        end
    end

    if self.IsShowAction then
        local Cfg = EmotionCfg:FindCfgByKey(EmotionID)
        if Cfg ~= nil then
            -- LSTR string: 表达%s
            self.TextAction = string.format(LSTR(450016), Cfg.EmotionName)
        end
    end
end

return TouringBandFanWinVM