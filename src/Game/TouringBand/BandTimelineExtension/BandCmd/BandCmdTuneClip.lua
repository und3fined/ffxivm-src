---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2024/12/24 16:55
---

local LuaClass = require("Core/LuaClass")
local ProtoRes = require ("Protocol/ProtoRes")
local AudioUtil = require("Utils/AudioUtil")
local BandCmdBase = require("Game/TouringBand/BandTimelineExtension/BandCmd/BandCmdBase")
local TouringBandUtil = require("Game/TouringBand/TouringBandUtil")

local BandCmdTuneClip = LuaClass(BandCmdBase)

function BandCmdTuneClip:OnInit()
    self.Name = "BandCmdTuneClip"
    self.EventType = ProtoRes.TOURING_BAND_TIMELINE_EVENT_SUB_TYPE.TB_SUB_TUNE
end

function BandCmdTuneClip:SetEntityID(InEntityID)
    self.EntityID = InEntityID
end

function BandCmdTuneClip:OnStart()
    if self.Param == nil then
        TouringBandUtil.Err("BandCmdCreateNpcClip.OnStart Create Failed ID =  : " .. self.ID)
        return
    end

    if self.EntityID <= 0 then
        TouringBandUtil.Err("BandCmdCreateNpcClip.OnStart Failed: Invalid EntityID (0) at Index = " .. tostring(self.TargetIndex))
        return
    end

    local SoundName = self.Param[1] or ""
    local SoundPath = TouringBandUtil:GetTunePath(SoundName)
    self.AudioID = AudioUtil.SyncLoadAndPlaySoundEvent(self.EntityID, SoundPath, true)
end

function BandCmdTuneClip:OnEnd()
    if self.AudioID == nil then
        return
    end
    AudioUtil.StopSound(self.AudioID)
    self.AudioID = nil
end

function BandCmdTuneClip:OnDestroy()
    if self.AudioID == nil then
        return
    end
    AudioUtil.StopSound(self.AudioID)
    self.AudioID = nil
end

return BandCmdTuneClip